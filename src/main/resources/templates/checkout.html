
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/public-layout}">
<head>
  <title>Завършване на поръчка - Борово Око</title>
</head>
<body>

<div layout:fragment="content">

  <!-- Header Section -->
  <section class="relative py-16 bg-brand-dark text-white overflow-hidden">
    <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#67b0b6 1px, transparent 1px); background-size: 30px 30px;"></div>
    <div class="container mx-auto px-6 relative z-10 text-center">
      <div class="inline-flex items-center gap-4 text-sm font-medium uppercase tracking-widest mb-4 text-stone-400">
        <span class="text-brand-teal">Количка</span>
        <i class="fas fa-chevron-right text-xs"></i>
        <span class="text-white">Данни за доставка</span>
        <i class="fas fa-chevron-right text-xs"></i>
        <span>Готово</span>
      </div>
      <h1 class="text-3xl md:text-5xl font-serif font-bold">Завършване</h1>
    </div>
  </section>

  <section class="relative py-16 bg-stone-50 min-h-[60vh]">
    <div class="container mx-auto px-6 relative z-10">

      <div th:if="${error}" class="max-w-4xl mx-auto mb-8 bg-red-50 border-l-4 border-red-500 p-4 rounded shadow-sm flex items-center gap-3">
        <div class="text-red-500"><i class="fas fa-exclamation-triangle text-xl"></i></div>
        <div class="text-red-700 font-medium" th:text="${error}"></div>
      </div>

      <form th:action="@{/checkout}" th:object="${guestDetails}" method="post" class="max-w-6xl mx-auto flex flex-col lg:flex-row gap-12">

        <!-- LEFT: Details Form -->
        <div class="lg:w-2/3 space-y-8">

          <!-- 1. Contact Info -->
          <div class="bg-white p-8 rounded-2xl shadow-sm border border-stone-100">
            <h3 class="text-xl font-serif font-bold text-brand-dark mb-6 flex items-center gap-3">
              <span class="w-8 h-8 rounded-full bg-brand-teal text-white flex items-center justify-center text-sm">1</span>
              Лични Данни
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-xs uppercase tracking-widest text-stone-500 mb-2 font-semibold">Имейл</label>
                <div class="relative">
                  <i class="fas fa-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-stone-400"></i>
                  <input type="email" th:field="*{email}" required
                         class="w-full bg-stone-50 border border-stone-200 rounded-xl pl-10 pr-4 py-3 focus:outline-none focus:border-brand-teal transition-colors text-stone-700"
                         placeholder="name@example.com">
                </div>
                <p class="text-[10px] text-stone-400 mt-1">За потвърждение на поръчката.</p>
              </div>
              <div>
                <label class="block text-xs uppercase tracking-widest text-stone-500 mb-2 font-semibold">Телефон</label>
                <div class="relative">
                  <i class="fas fa-phone absolute left-4 top-1/2 transform -translate-y-1/2 text-stone-400"></i>
                  <input type="tel" th:field="*{phone}" required
                         class="w-full bg-stone-50 border border-stone-200 rounded-xl pl-10 pr-4 py-3 focus:outline-none focus:border-brand-teal transition-colors text-stone-700"
                         placeholder="089 123 4567">
                </div>
                <p class="text-[10px] text-stone-400 mt-1">За връзка при доставка.</p>
              </div>
            </div>
          </div>

          <!-- 2. Location (Targovishte Locked) -->
          <div class="bg-white p-8 rounded-2xl shadow-sm border border-stone-100 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-brand-teal"></div>

            <h3 class="text-xl font-serif font-bold text-brand-dark mb-6 flex items-center gap-3">
              <span class="w-8 h-8 rounded-full bg-brand-teal text-white flex items-center justify-center text-sm">2</span>
              Адрес за доставка
            </h3>

            <div class="mb-4 bg-blue-50 text-blue-800 px-4 py-3 rounded-lg text-sm flex items-start gap-3">
              <i class="fas fa-map-marker-alt mt-1"></i>
              <div>
                <strong>Само за гр. Търговище.</strong>
                <p class="text-xs mt-1">В момента извършваме доставки само в рамките на града и околността.</p>
              </div>
            </div>

            <div>
              <label class="block text-xs uppercase tracking-widest text-stone-500 mb-2 font-semibold">Адрес</label>
              <div class="flex shadow-sm rounded-xl overflow-hidden border border-stone-200 focus-within:ring-1 focus-within:ring-brand-teal focus-within:border-brand-teal transition-all">
                <!-- Locked City Prefix -->
                <div class="bg-stone-100 px-4 py-3 flex items-center text-stone-500 border-r border-stone-200 select-none whitespace-nowrap">
                  <i class="fas fa-city mr-2 text-xs"></i> гр. Търговище,
                </div>
                <!-- User Input -->
                <input type="text" th:field="*{location}" required
                       class="flex-grow bg-white px-4 py-3 focus:outline-none text-stone-700 placeholder-stone-400"
                       placeholder="кв. Запад 2, бл. 15, вх. Б, ет. 3...">
              </div>
              <p class="text-[10px] text-stone-400 mt-1">Моля, въведете квартал/улица, номер, вход и етаж.</p>
            </div>
          </div>

          <!-- 3. Payment Method -->
          <div class="bg-white p-8 rounded-2xl shadow-sm border border-stone-100">
            <h3 class="text-xl font-serif font-bold text-brand-dark mb-6 flex items-center gap-3">
              <span class="w-8 h-8 rounded-full bg-brand-teal text-white flex items-center justify-center text-sm">3</span>
              Начин на плащане
            </h3>

            <div class="space-y-3">
              <!-- Cash Option -->
              <label class="flex items-center justify-between p-4 border border-stone-200 rounded-xl cursor-pointer transition-colors hover:bg-stone-50 has-[:checked]:border-brand-teal has-[:checked]:bg-teal-50/30">
                <div class="flex items-center gap-3">
                  <input type="radio" th:field="*{cash}" value="true" class="w-5 h-5 text-brand-teal focus:ring-brand-teal border-gray-300 bg-white">
                  <div>
                    <span class="block font-bold text-brand-dark">Наложен платеж</span>
                    <span class="text-xs text-stone-500">Плащане в брой при доставка</span>
                  </div>
                </div>
                <i class="fas fa-money-bill-wave text-brand-teal text-xl"></i>
              </label>

              <!-- Card Option (Enabled) -->
              <label class="flex items-center justify-between p-4 border border-stone-200 rounded-xl cursor-pointer transition-colors hover:bg-stone-50 has-[:checked]:border-brand-teal has-[:checked]:bg-teal-50/30">
                <div class="flex items-center gap-3">
                  <input type="radio" th:field="*{cash}" value="false" class="w-5 h-5 text-brand-teal focus:ring-brand-teal border-gray-300 bg-white">
                  <div>
                    <span class="block font-bold text-brand-dark">С карта</span>
                    <span class="text-xs text-stone-500">Сигурно онлайн плащане със Stripe</span>
                  </div>
                </div>
                <i class="fas fa-credit-card text-brand-teal text-xl"></i>
              </label>
            </div>
          </div>

        </div>

        <!-- RIGHT: Summary -->
        <div class="lg:w-1/3">
          <div class="bg-white p-8 rounded-2xl shadow-lg border border-stone-100 sticky top-32">
            <h3 class="text-xl font-serif font-bold text-brand-dark mb-6 border-b border-stone-100 pb-4">Вашата Поръчка</h3>

            <!-- Mini Cart List -->
            <div class="max-h-60 overflow-y-auto pr-2 mb-6 space-y-4 custom-scrollbar">
              <div th:each="item : ${cart.cartItems}" class="flex justify-between items-start text-sm">
                <div>
                  <span class="font-bold text-stone-700 block" th:text="${item.product.name}">Item Name</span>
                  <div class="flex flex-col">
                    <span class="text-xs text-stone-500" th:text="${item.quantity} + ' x ' + ${#numbers.formatDecimal(item.product.price, 1, 2)} + ' лв.'">1 x 10.00 лв.</span>
                    <span class="text-[10px] text-stone-400" th:text="'(' + ${#numbers.formatDecimal(item.product.euroPrice, 1, 2)} + ' €)'"> (5.11 €)</span>
                  </div>
                </div>
                <div class="text-right">
                  <span class="font-medium text-brand-dark block" th:text="${#numbers.formatDecimal(item.product.price * item.quantity, 1, 2)} + ' лв.'">10.00 лв.</span>
                  <span class="text-xs text-stone-400 block" th:text="${#numbers.formatDecimal(item.product.euroPrice * item.quantity, 1, 2)} + ' €'">5.11 €</span>
                </div>
              </div>
            </div>

            <div class="border-t border-stone-100 pt-4 space-y-2 mb-6">
              <div class="flex justify-between text-stone-600">
                <span>Междинна сума</span>
                <div class="text-right">
                  <span class="font-medium block" th:text="${#numbers.formatDecimal(totalPrice, 1, 2)} + ' лв.'">0.00 лв.</span>
                  <span class="text-xs text-stone-400 block" th:text="${#numbers.formatDecimal(totalEuro, 1, 2)} + ' €'">0.00 €</span>
                </div>
              </div>
              <div class="flex justify-between text-stone-600">
                <span>Доставка</span>
                <span class="text-green-600 font-medium text-xs uppercase tracking-wider bg-green-50 px-2 py-1 rounded">Безплатна</span>
              </div>
            </div>

            <div class="flex justify-between items-end border-t border-stone-100 pt-6 mb-8">
              <span class="text-lg font-serif font-bold text-brand-dark">Общо</span>
              <div class="text-right">
                <span class="block text-3xl font-bold text-brand-teal" th:text="${#numbers.formatDecimal(totalPrice, 1, 2)} + ' лв.'">0.00 лв.</span>
                <span class="block text-lg font-medium text-stone-500 mt-1" th:text="${#numbers.formatDecimal(totalEuro, 1, 2)} + ' €'">0.00 €</span>
              </div>
            </div>

            <button type="submit" class="block w-full bg-brand-dark text-white text-center font-bold py-4 rounded-xl hover:bg-brand-teal transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1">
              Поръчай Сега <i class="fas fa-check ml-2"></i>
            </button>

            <div class="mt-4 text-center text-[10px] text-stone-400">
              С натискането на бутона се съгласявате с нашите Общи условия.
            </div>
          </div>
        </div>
      </form>
    </div>
  </section>
</div>

</body>
</html>
