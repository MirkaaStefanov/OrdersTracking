<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout}">
<head>
  <title>Управление на Продукти</title>
</head>
<body>
<div layout:fragment="content">

  <div class="header-actions">
    <h1><i class="fas fa-utensils mr-2"></i> Управление на Продукти</h1>
    <a th:href="@{/admin/products/new}" class="btn btn-primary">
      <i class="fas fa-plus-circle mr-2"></i> Добави нов продукт
    </a>
  </div>

  <form th:action="@{/admin/products}" method="get" class="filter-form">
    <div class="form-group">
      <label for="category">Категория:</label>
      <select id="category" name="category">
        <option value="" th:selected="${selectedCategory == null}">Всички</option>
        <option th:each="cat : ${categories}"
                th:value="${cat}"
                th:text="${cat.displayName}"
                th:selected="${cat == selectedCategory}">
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="available">Наличност:</label>
      <select id="available" name="available">
        <option value="" th:selected="${selectedAvailable == null}">Всички</option>
        <option value="true" th:selected="${selectedAvailable != null && selectedAvailable}">Налични</option>
        <option value="false" th:selected="${selectedAvailable != null && !selectedAvailable}">Неналични</option>
      </select>
    </div>

    <button type="submit" class="btn btn-primary">
      <i class="fas fa-filter mr-2"></i> Филтрирай
    </button>

    <a th:href="@{/admin/products}" class="btn btn-secondary">
      <i class="fas fa-sync-alt mr-2"></i> Изчисти
    </a>
  </form>

  <div class="table-responsive">
    <table>
      <thead>
      <tr>
        <th>Име</th>
        <th>Категория</th>
        <th>Цена (ЛВ)</th>
        <th>Цена (EUR)</th>
        <th>Грамаж</th>
        <th>Наличен</th>
        <th>Действия</th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${products.isEmpty()}">
        <td colspan="7" style="text-align: center; color: #64748b; padding: 2rem;">
          <i class="fas fa-inbox"></i> Няма намерени продукти, отговарящи на филтъра.
        </td>
      </tr>
      <tr th:unless="${products.isEmpty()}" th:each="product : ${products}">
        <td style="font-weight: 600;" th:text="${product.name}"></td>
        <td th:text="${product.category.displayName}"></td>
        <td th:text="${#numbers.formatDecimal(product.price, 1, 2)} + ' лв'"></td>
        <td th:text="${#numbers.formatDecimal(product.euroPrice, 1, 2)} + ' €'"></td>
        <td th:text="${product.gr} + ' гр'"></td>
        <td>
            <span th:if="${product.available}" class="status-badge status-active">
              <i class="fas fa-check-circle mr-1"></i>Да
            </span>
          <span th:unless="${product.available}" class="status-badge status-inactive">
              <i class="fas fa-times-circle mr-1"></i>Не
            </span>
        </td>
        <td class="actions-cell">
          <a th:href="@{/admin/products/edit/{id}(id=${product.id})}" class="btn btn-outline btn-sm" title="Редактирай">
            <i class="fas fa-edit"></i>
          </a>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

</div>
</body>
</html>