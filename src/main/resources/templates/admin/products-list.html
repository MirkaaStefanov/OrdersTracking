
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout}">
<head>
  <title>Продукти</title>
</head>
<body>
<div layout:fragment="content">

  <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
    <div>
      <h1 class="text-3xl md:text-4xl font-serif font-bold text-brand-dark">Продукти</h1>
      <p class="text-stone-500 mt-1 text-sm">Управление на менюто, цените и наличностите</p>
    </div>
    <a th:href="@{/admin/products/new}" class="bg-brand-teal text-white px-6 py-3 rounded-full font-bold shadow-lg hover:bg-brand-dark transition-all transform hover:-translate-y-1 flex items-center gap-2">
      <i class="fas fa-plus-circle"></i> Нов Продукт
    </a>
  </div>

  <!-- Filter Card -->
  <div class="bg-white rounded-2xl shadow-sm border border-stone-100 p-6 mb-8">
    <form th:action="@{/admin/products}" method="get" class="flex flex-col md:flex-row gap-6 items-end">

      <div class="flex-grow w-full md:w-auto">
        <label for="category" class="block text-xs uppercase tracking-widest text-stone-500 mb-2 font-semibold">Категория</label>
        <div class="relative">
          <i class="fas fa-filter absolute left-4 top-1/2 transform -translate-y-1/2 text-stone-400"></i>
          <select id="category" name="category" class="w-full bg-stone-50 border border-stone-200 rounded-lg pl-10 pr-4 py-3 focus:outline-none focus:border-brand-teal transition-colors appearance-none cursor-pointer text-stone-700">
            <option value="" th:selected="${selectedCategory == null}">Всички Категории</option>
            <option th:each="cat : ${categories}"
                    th:value="${cat}"
                    th:text="${cat.displayName}"
                    th:selected="${cat == selectedCategory}">
            </option>
          </select>
        </div>
      </div>

      <div class="flex-grow w-full md:w-auto">
        <label for="available" class="block text-xs uppercase tracking-widest text-stone-500 mb-2 font-semibold">Статус</label>
        <div class="relative">
          <i class="fas fa-check-circle absolute left-4 top-1/2 transform -translate-y-1/2 text-stone-400"></i>
          <select id="available" name="available" class="w-full bg-stone-50 border border-stone-200 rounded-lg pl-10 pr-4 py-3 focus:outline-none focus:border-brand-teal transition-colors appearance-none cursor-pointer text-stone-700">
            <option value="" th:selected="${selectedAvailable == null}">Всички</option>
            <option value="true" th:selected="${selectedAvailable != null && selectedAvailable}">Налични</option>
            <option value="false" th:selected="${selectedAvailable != null && !selectedAvailable}">Неналични</option>
          </select>
        </div>
      </div>

      <div class="flex gap-3 w-full md:w-auto">
        <button type="submit" class="bg-brand-dark text-white px-6 py-3 rounded-lg font-medium hover:bg-brand-teal transition-colors flex-grow md:flex-grow-0 text-center shadow-md">
          <i class="fas fa-search mr-1"></i> Търси
        </button>

        <a th:href="@{/admin/products}" class="bg-stone-200 text-stone-600 px-6 py-3 rounded-lg font-medium hover:bg-stone-300 transition-colors flex-grow md:flex-grow-0 text-center" title="Изчисти">
          <i class="fas fa-times"></i>
        </a>
      </div>
    </form>
  </div>

  <!-- Table Card -->
  <div class="bg-white rounded-2xl shadow-lg border border-stone-100 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead class="bg-stone-50 text-stone-600 uppercase text-xs tracking-wider font-semibold border-b border-stone-200">
        <tr>
          <th class="p-6">Продукт</th>
          <th class="p-6">Категория</th>
          <th class="p-6">Цена</th>
          <th class="p-6">Статус</th>
          <th class="p-6 text-right">Действия</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-stone-100 text-sm">
        <tr th:if="${products.isEmpty()}">
          <td colspan="5" class="p-12 text-center text-stone-400">
            <div class="inline-block p-4 rounded-full bg-stone-50 mb-3"><i class="fas fa-inbox text-3xl"></i></div>
            <p class="text-lg">Няма намерени продукти.</p>
          </td>
        </tr>
        <tr th:unless="${products.isEmpty()}" th:each="product : ${products}" class="hover:bg-stone-50 transition-colors group">

          <!-- Product Name/Desc -->
          <td class="p-6">
            <div class="flex flex-col">
              <span class="font-serif font-bold text-brand-dark text-lg" th:text="${product.name}">Име</span>
              <span class="text-stone-400 text-xs truncate max-w-[200px]" th:text="${product.description}">Описание</span>
              <span class="text-stone-400 text-xs mt-1" th:text="${product.gr} + ' гр.'">500 гр.</span>
            </div>
          </td>

          <!-- Category -->
          <td class="p-6">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-stone-100 text-stone-800 border border-stone-200" th:text="${product.category.displayName}">
                    Category
                </span>
          </td>

          <!-- Price -->
          <td class="p-6">
            <div class="flex flex-col">
              <span class="font-bold text-brand-dark text-base" th:text="${#numbers.formatDecimal(product.price, 1, 2)} + ' лв.'">Price</span>
              <span class="text-stone-400 text-xs" th:text="${#numbers.formatDecimal(product.euroPrice, 1, 2)} + ' €'">Euro</span>
            </div>
          </td>

          <!-- Status with Toggle Form -->
          <td class="p-6">
            <form th:action="@{/admin/products/toggle/{id}(id=${product.id})}" method="post">
              <button type="submit" class="cursor-pointer focus:outline-none" title="Натисни за промяна">
                        <span th:if="${product.available}" class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider bg-green-50 text-green-700 border border-green-100 hover:bg-green-100 transition-colors">
                          <span class="w-2 h-2 rounded-full bg-green-500"></span> Наличен
                        </span>
                <span th:unless="${product.available}" class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider bg-red-50 text-red-700 border border-red-100 hover:bg-red-100 transition-colors">
                          <span class="w-2 h-2 rounded-full bg-red-500"></span> Скрит
                        </span>
              </button>
            </form>
          </td>

          <!-- Actions -->
          <td class="p-6 text-right">
            <div class="flex justify-end gap-2">
              <!-- Edit -->
              <a th:href="@{/admin/products/edit/{id}(id=${product.id})}"
                 class="group flex items-center justify-center w-8 h-8 rounded-full border border-stone-200 text-stone-500 hover:bg-brand-teal hover:text-white hover:border-brand-teal transition-all shadow-sm"
                 title="Редакция">
                <i class="fas fa-pen text-xs"></i>
              </a>

              <!-- Delete -->
              <form th:action="@{/admin/products/delete/{id}(id=${product.id})}" method="post" onsubmit="return confirm('Сигурни ли сте, че искате да изтриете този продукт?');">
                <button type="submit"
                        class="group flex items-center justify-center w-8 h-8 rounded-full border border-stone-200 text-stone-500 hover:bg-red-500 hover:text-white hover:border-red-500 transition-all shadow-sm"
                        title="Изтрий">
                  <i class="fas fa-trash text-xs"></i>
                </button>
              </form>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>
</body>
</html>
